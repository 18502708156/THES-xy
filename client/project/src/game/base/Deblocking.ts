enum DeblockingType { 
	TYPE_1 = 1, // 自动熔炼功能	
	TYPE_2 = 2, // 王者争霸	
	TYPE_3 = 3, // 自动战斗	
	TYPE_4 = 4, // 锻造强化	
	TYPE_5 = 5, // 锻造精炼	
	TYPE_6 = 6, // 锻造锻炼	
	TYPE_7 = 7, // 锻造宝石	
	TYPE_8 = 8, // 角色技能	
	TYPE_9 = 9, // 角色坐骑	
	TYPE_10 = 10, // 角色翅膀	
	TYPE_11 = 11, // 宠物	
	TYPE_12 = 12, // 宠物技能	
	TYPE_13 = 13, // 宠物通灵	
	TYPE_14 = 14, // 宠物兽魂	
	TYPE_15 = 15, // 仙侣	
	TYPE_16 = 16, // 仙侣升星	
	TYPE_17 = 17, // 仙侣法阵	
	TYPE_18 = 18, // 仙侣仙位	
	TYPE_19 = 19, // 玄女	
	TYPE_20 = 20, // 玄女仙器	
	TYPE_21 = 21, // 玄女花辇	
	TYPE_22 = 22, // 玄女灵气	
	TYPE_23 = 23, // 神将	
	TYPE_24 = 24, // 神将神兵	
	TYPE_25 = 25, // 神将将阵	
	TYPE_26 = 26, // 神将官职	
	TYPE_27 = 27, // 守护	
	TYPE_28 = 28, // 神兵	
	TYPE_29 = 29, // 丹药	
	TYPE_30 = 30, // 经脉	
	TYPE_31 = 31, // 法宝	
	TYPE_32 = 32, // 神装	
	TYPE_33 = 33, // 时装	
	TYPE_34 = 34, // 称号	
	TYPE_35 = 35, // 材料副本	
	TYPE_36 = 36, // 藏宝图	
	TYPE_37 = 37, // 玲珑宝塔	
	TYPE_38 = 38, // 勇闯天庭	
	TYPE_39 = 39, // 姻缘	
	TYPE_40 = 40, // 房屋	
	TYPE_41 = 41, // 师徒	
	TYPE_42 = 42, // 竞技场	
	TYPE_43 = 43, // 天下第一	
	TYPE_44 = 44, // 个人BOSS	
	TYPE_45 = 45, // 全民BOSS	
	TYPE_46 = 46, // 野外BOSS	
	TYPE_47 = 47, // 九重天	
	TYPE_48 = 48, // 日常	
	TYPE_49 = 49, // 聊天发送功能	
	TYPE_50 = 50, // 帮会	
	TYPE_51 = 51, // 帮会上香	
	TYPE_52 = 52, // 帮会副本	
	TYPE_53 = 53, // 帮会技能	
	TYPE_54 = 54, // 帮会地图	
	TYPE_55 = 55, // 帮会守护	
	TYPE_56 = 56, // 帮会帮战	
	TYPE_57 = 57, // 帮会商店	
	TYPE_58 = 58, // 帮会妖怪	
	TYPE_59 = 59, // 西游护送	
	TYPE_60 = 60, // 答题比赛	
	TYPE_61 = 61, // 跨服争霸	
	TYPE_62 = 62, // 武林盟主	
	TYPE_63 = 63, // 跨服组队	
	TYPE_64 = 64, // 跨服BOSS	
	TYPE_65 = 65, // 跨服渔场	
	TYPE_66 = 66, // 元宝商店	
	TYPE_67 = 67, // 绑元商店	
	TYPE_68 = 68, // 宠物商城	
	TYPE_69 = 69, // 仙侣商城	
	TYPE_70 = 70, // 装备商店	
	TYPE_71 = 71, // 雷音福利	
	TYPE_72 = 72, // 帮会商店	
	TYPE_73 = 73, // 帮会福利	
	TYPE_74 = 74, // 装扮商店	
	TYPE_75 = 75, // 皮肤商店	
	TYPE_76 = 76, // 友情商店	
	TYPE_77 = 77, // 威望商店	
	TYPE_78 = 78, // 竞技商店	
	TYPE_79 = 79, // 竞技福利	
	TYPE_80 = 80, // 护送商店	
	TYPE_81 = 81, // 答题商店	
	TYPE_82 = 82, // 全民BOSS商店	
	TYPE_83 = 83, // 生死劫商店	
	TYPE_84 = 84, // 个人商店	
	TYPE_85 = 85, // 熔炼功能	
	TYPE_86 = 86, // 排行榜	
	TYPE_87 = 87, // 银两兑换功能	
	TYPE_88 = 88, // 矿山争夺战	
	TYPE_89 = 89, // 好友功能	
	TYPE_90 = 90, // 北斗七星(缘份功能)	
	TYPE_91 = 91, // 天兵天将	
	TYPE_92 = 92, // 大闹天宫	
	TYPE_93 = 93, // 星宿神君	
	TYPE_94 = 94, // 西游历练	
	TYPE_95 = 95, // 主城解锁等级	
	TYPE_96 = 96, // 快捷购买界面	
	TYPE_97 = 97,//开服目标-开服团购
	TYPE_98 = 98,//开服目标-战宠副本
	TYPE_99 = 99,//开服目标-全民冲级
	TYPE_100 = 100,//开服目标-全民战力
	TYPE_101 = 101,//开服目标-外观折扣
	TYPE_102 = 102,//开服目标-连续充值
	TYPE_103 = 103, // 七天尊享
	TYPE_104 = 104, // 人民币礼包
	TYPE_105 = 105, // 直升一阶
	TYPE_106 = 106, // 成长基金
	TYPE_107 = 107, // 投资计划
	TYPE_108 = 108, // 消费有礼
	TYPE_109 = 109, // 进阶狂欢
	TYPE_110 = 110, // 送十万元宝
	TYPE_111 = 111, // 寻宝功能
	TYPE_112 = 112, // 拍卖行功能
	TYPE_113 = 113, // 阵型
	TYPE_114 = 114, // 八十一难功能
	TYPE_115 = 115, // 关卡求助
	TYPE_116 = 116, // 灵童
	TYPE_117 = 117, // 天神降临
	TYPE_118 = 118, // 天女下凡
	TYPE_119 = 119, // 图腾	
	TYPE_120 = 120, // 命格	
	TYPE_212 = 212, // 玄女下凡	
	TYPE_121 = 121, // 活动大厅	
	TYPE_122 = 122, // 降服神兽	
	TYPE_123 = 123, // 神兽降临	
	TYPE_124 = 124, // 开服活动	
	TYPE_125 = 125, // 福利大厅	
	TYPE_126 = 126, // 每日首充	
	TYPE_127 = 127, // 月卡
	TYPE_128 = 128, // 背包
	TYPE_129 = 129, // 首充
	TYPE_130 = 130, // 送元宝
	TYPE_131 = 131, // 1元充值
	TYPE_132 = 132, // 充值返利
	TYPE_133 = 133, // 精彩活动
	TYPE_134 = 134, // 邮件
	TYPE_137 = 137, // 神装转盘
	TYPE_138 = 138, // 神秘商店
	TYPE_140 = 140, //每日豪礼
	TYPE_141 = 141, //累充回馈
	TYPE_142 = 142, //阵位预告
	TYPE_143 = 143, // 图腾转盘
	TYPE_144 = 144,
}

class Deblocking {

	/*
	1、通关关卡数
	2、人物等级
	3、VIP等级
	4、开服天数
	5、登录天数
	6、开服周数
	*/

	public static readonly CHECK_TYPE_01 = 1
	public static readonly CHECK_TYPE_02 = 2
	public static readonly CHECK_TYPE_03 = 3
	public static readonly CHECK_TYPE_04 = 4 // 4、5、6
	// public static readonly CHECK_TYPE_05 = 5
	// public static readonly CHECK_TYPE_06 = 6

	private static CONVERT = {
		[1]: 1,
		[2]: 2,
		[3]: 3,
		[4]: 4,
		[5]: 4,
		[6]: 4,
	}

	private static KEYS = ["conditionkind", "conditionkind2"]
	private static VALUES = ["conditionnum", "conditionnum2"]

	/**condition = 1 与， 2 或 */
	private static CheckSinge(type: number, value: number): boolean {
		if (!type || !value) {
			return true
		}
		switch (type) {
			case 1:
				if (GameGlobal.UserFb.guanqiaID >= value) {
					return true
				}
				break

			case 2:
				if (GameGlobal.actorModel.level >= value) {
					return true
				}
				break
			case 3:
				if (GameGlobal.actorModel.vipLv >= value) {
					return true
				}
				break

			case 4:
				if (GameServer.serverOpenDay >= value) {
					return true
				}
				break

			case 5:
				if (GameServer.loginDay >= value) {
					return true
				}
				break

			case 6:
				// if (value == 2) {
				// 	return GuildWar.ins().IsServerWarOpen2()
				// }
				// if (GuildWar.ins().IsServerWarOpen()) {
				// 	return true
				// }
				break

			// 默认开启
			default:
				return true
		}
		return false
	}

	private static m_Initds: { [key: number]: boolean } = {}
	private static m_DoCheckList: { [key: number]: number[] } = {}

	public static mOpenIds: number[] = []

	public static Init(): void {
		let config = GameGlobal.Config.FuncOpenConfig
		for (let key in config) {
			let data = config[key]
			if (data.isOpen) {
				for (let i = 0; i < this.KEYS.length; ++i) {
					let type = Deblocking.CONVERT[data[this.KEYS[i]]]
					let list = this.m_DoCheckList[type]
					if (!list) {
						this.m_DoCheckList[type] = list = []
					}
					list.push(data.id)
				}
			}
		}
	}

	public static Update(type: number) {
		// let dataList = this.m_DoCheckList[type]
		// if (!dataList) {
		// 	return
		// }
		// let openList = null
		// if (this.m_Initds[type]) {
		// 	openList = {}
		// }
		// this.m_Initds[type] = true
		// for (let i = dataList.length - 1; i >= 0; --i) {
		// 	if (this.Check(dataList[i], true)) {
		// 		if (openList) {
		// 			openList[dataList[i]] = true
		// 		}
		// 		dataList.splice(i, 1)
		// 	}
		// }
		// if (dataList.length < 1) {
		// 	delete this.m_DoCheckList[type]
		// }
		// if (openList) {
		// 	for (let key in openList) {
		// 		this.mOpenIds.push(Number(key))
		// 	}
		// 	this.mOpenIds.sort(function (lhs, rhs) {
		// 		return lhs - rhs
		// 	})
		// 	GameGlobal.MessageCenter.dispatch(MessageDef.GAME_DEBLOCKING)
		// }
	}

	// 是否解锁
	public static IsDeblocking(type: number) {
		return this.Check(type, true)
	}

	public static Check(type: number, notTip = false): boolean {
		let cfg = GameGlobal.Config.FuncOpenConfig[type]
		if (!cfg || !cfg.conditionkind) {
			return true
		}
		let result = true
		if (!cfg.condition || cfg.condition == 1) {
			for (let i = 0; i < this.KEYS.length; ++i) {
				let type = this.KEYS[i]
				let value = this.VALUES[i]
				if (!this.CheckSinge(cfg[type], cfg[value])) {
					result = false
					break
				}
			}
		}
		else if (!cfg.condition || cfg.condition == 2) {
			result = false;
			for (let i = 0; i < this.KEYS.length; ++i) {
				let type = this.KEYS[i]
				let value = this.VALUES[i]
				if (this.CheckSinge(cfg[type], cfg[value])) {
					result = true;
					break
				}
			}
		}

		if (result) {
			return true
		}

		if (!notTip) {
			UserTips.InfoTip(cfg.opencondition)
		}
		// Deblocking._ShowTip(conType, conValue, notTip, cfg.opencondition)
		return false
	}

	private static _ShowTip(type, value: number, notTip = false, tipValue) {
		if (notTip) {
			return
		}
		let str = tipValue
		if (!str) {
			switch (type) {
				case 1:
					str = `通关到第${value}关开启`
					break
				case 2:
					str = `${value}级开启`
					break
				case 3:
					str = `登录第${value}天开启`
					break
			}
		}
		if (str) {
			UserTips.InfoTip(str)
		}
	}

	public static IsHide(type: number): boolean {
		if (this.Check(type, true)) {
			return false
		}
		let cfg = GameGlobal.Config.FuncOpenConfig[type]
		if (cfg && cfg.isHide == 1) {
			return true
		}
		return false
	}
}
